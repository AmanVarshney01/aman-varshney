---
export const prerender = false;
import { db, Guestbook as gb, desc } from "astro:db";
import Layout from "../layouts/Layout.astro";

if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const name = formData.get("name");
  const message = formData.get("message");
  if (typeof name === "string" && typeof message === "string") {
    await db.insert(gb).values({ name, message });
  }
}
const guestbookData = await db.select().from(gb).orderBy(desc(gb.published));
---

<Layout title="Guestbook | Aman Varshney">
  <h1>Guestbook</h1>
  <form method="POST" class="flex flex-col md:flex-row gap-2">
    <input
      id="name"
      name="name"
      placeholder="Name"
      class="py-1 px-2 rounded-lg"
      required
    />
    <input
      name="message"
      placeholder="Message"
      class="py-1 px-2 rounded-lg"
      required
    />
    <button type="submit" class="py-1 px-2 ring rounded-lg">Submit</button>
  </form>
  <section class="pt-10 flex flex-col gap-2">
    {
      guestbookData.map(({ name, message }) => {
        return (
          <div>
            <strong>{name}:</strong>
            {message}
          </div>
        );
      })
    }
  </section>
</Layout>
